<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å´ä¹¦é¢–è‹±è¯­èƒŒè¯µç¥å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .blur-text { filter: blur(6px); user-select: none; opacity: 0.4; }
        .no-blur { filter: blur(0); opacity: 1; }
        /* ç®€å•çš„åŠ¨ç”» */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="max-w-md w-full bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-200">
        
        <div class="bg-indigo-600 p-6 text-white">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-bold flex items-center gap-2">
                    <i data-lucide="star" class="text-yellow-300 fill-current"></i> 
                    èƒŒè¯µåŠ©æ‰‹
                </h1>
                <span id="progress-text" class="text-indigo-200 text-sm font-mono">1 / 13</span>
            </div>
            
            <div class="w-full bg-indigo-800 rounded-full h-2 mb-2 overflow-hidden">
                <div id="progress-bar" class="bg-yellow-400 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            
            <div class="flex justify-between bg-indigo-700/50 p-1 rounded-lg mt-4">
                <button onclick="setMode('learn')" id="btn-mode-learn" class="mode-btn flex-1 py-2 text-xs font-medium rounded-md transition-all bg-white text-indigo-700 shadow-sm">ğŸ‘€ å­¦ä¹ æ¨¡å¼</button>
                <button onclick="setMode('recite')" id="btn-mode-recite" class="mode-btn flex-1 py-2 text-xs font-medium rounded-md transition-all text-indigo-200 hover:text-white">ğŸ™ˆ é®ç›–æ¨¡å¼</button>
                <button onclick="setMode('quiz')" id="btn-mode-quiz" class="mode-btn flex-1 py-2 text-xs font-medium rounded-md transition-all text-indigo-200 hover:text-white">âœï¸ å¡«ç©ºæµ‹è¯•</button>
            </div>
        </div>

        <div id="content-area" class="p-6 flex flex-col items-center min-h-[300px] justify-center relative bg-white">
            </div>

        <div class="bg-slate-50 p-4 border-t border-slate-100">
            <div class="flex items-center justify-center gap-6 mb-6">
                <button onclick="playAudio(0.6)" class="flex flex-col items-center gap-1 text-xs font-medium text-slate-400 hover:text-indigo-500 transition-colors">
                    <div class="p-3 bg-white rounded-full shadow-sm border border-slate-200 active:scale-95 transition-transform">
                        <i data-lucide="turtle" size="20"></i>
                    </div>
                    æ…¢é€Ÿè¯»
                </button>

                <button onclick="playAudio(1.0)" class="w-16 h-16 bg-indigo-600 rounded-full shadow-lg hover:bg-indigo-700 active:scale-95 flex items-center justify-center text-white transition-all ring-4 ring-indigo-100">
                    <i data-lucide="volume-2" size="32"></i>
                </button>

                <button onclick="playAudio(1.0)" class="flex flex-col items-center gap-1 text-xs font-medium text-slate-400 hover:text-indigo-500 transition-colors">
                    <div class="p-3 bg-white rounded-full shadow-sm border border-slate-200 active:scale-95 transition-transform">
                        <i data-lucide="zap" size="20"></i>
                    </div>
                    åŸé€Ÿè¯»
                </button>
            </div>

            <div class="flex justify-between items-center gap-4">
                <button onclick="prevSentence()" id="btn-prev" class="flex items-center gap-1 px-4 py-2 rounded-lg font-medium text-indigo-600 hover:bg-indigo-50 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i data-lucide="chevron-left"></i> ä¸Šä¸€å¥
                </button>

                <button onclick="nextSentence()" id="btn-next" class="flex items-center gap-1 px-5 py-2.5 rounded-lg font-medium bg-indigo-600 text-white shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed">
                    ä¸‹ä¸€å¥ <i data-lucide="chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- æ•°æ® ---
        const SENTENCES = [
            { en: "Friendship, like sunshine, is warm and bright.", cn: "å‹è°Šåƒé˜³å…‰ä¸€æ ·ï¼Œæ—¢æ¸©æš–åˆæ˜äº®ã€‚" },
            { en: "I have a good friend, and her name is An Xin.", cn: "æˆ‘æœ‰ä¸€ä¸ªå¥½æœ‹å‹ï¼Œå¥¹çš„åå­—å«å®‰å¿ƒã€‚" },
            { en: "An Xin has big eyes and long black hair.", cn: "å®‰å¿ƒæœ‰ç€å¤§çœ¼ç›å’Œé»‘è‰²çš„é•¿å‘ã€‚" },
            { en: "She is not very tall, but she is good at sports and modern dance.", cn: "å¥¹ä¸æ˜¯å¾ˆé«˜ï¼Œä½†å¥¹æ“…é•¿è¿åŠ¨å’Œç°ä»£èˆã€‚" },
            { en: "We often play table tennis together after school.", cn: "æ”¾å­¦åæˆ‘ä»¬ç»å¸¸ä¸€èµ·æ‰“ä¹’ä¹“çƒã€‚" },
            { en: "An Xin is kind, friendly, and funny.", cn: "å®‰å¿ƒå–„è‰¯ã€å‹å¥½è€Œä¸”é£è¶£ï¼ˆæç¬‘ï¼‰ã€‚" },
            { en: "She always helps others and makes people laugh.", cn: "å¥¹æ€»æ˜¯å¸®åŠ©åˆ«äººï¼Œå¹¶ä¸”è®©äººå‘ç¬‘ã€‚" },
            { en: "When I feel sad or blue, she always cheers me up.", cn: "å½“æˆ‘è§‰å¾—ä¼¤å¿ƒéš¾è¿‡çš„æ—¶å€™ï¼Œå¥¹ç»å¸¸é¼“èˆæˆ‘ã€‚" },
            { en: "I can trust her and share my thoughts with her.", cn: "æˆ‘å¯ä»¥ä¿¡ä»»å¥¹ï¼Œå¹¶ä¸å¥¹åˆ†äº«æˆ‘çš„æƒ³æ³•ã€‚" },
            { en: "She is good at English and often helps me with my English homework in her free time.", cn: "å¥¹æ“…é•¿è‹±è¯­ï¼Œç»å¸¸åœ¨ç©ºé—²æ—¶é—´å¸®æˆ‘åšè‹±è¯­ä½œä¸šã€‚" },
            { en: "With An Xinâ€™s help, I have become more open and confident.", cn: "åœ¨å®‰å¿ƒçš„å¸®åŠ©ä¸‹ï¼Œæˆ‘å˜å¾—æ›´åŠ å¼€æœ—å’Œè‡ªä¿¡ã€‚" },
            { en: "I have the courage to speak English and try new things.", cn: "æˆ‘æœ‰å‹‡æ°”è¯´è‹±è¯­å¹¶å°è¯•æ–°äº‹ç‰©ã€‚" },
            { en: "Itâ€™s wonderful to have such a good friend, and I hope we will be friends forever.", cn: "æœ‰è¿™æ ·ä¸€ä¸ªå¥½æœ‹å‹çœŸå¥½ï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬å°†æ°¸è¿œæ˜¯æœ‹å‹ã€‚" }
        ];

        // --- çŠ¶æ€ ---
        let currentIndex = 0;
        let mode = 'learn'; // 'learn', 'recite', 'quiz'
        let showEnglishInRecite = false; // åœ¨é®ç›–æ¨¡å¼ä¸‹æ˜¯å¦ä¸´æ—¶æ˜¾ç¤ºè‹±æ–‡
        let synth = window.speechSynthesis;
        let currentUtterance = null;

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            render();
        });

        // --- æ ¸å¿ƒé€»è¾‘ ---

        function render() {
            const data = SENTENCES[currentIndex];
            const contentArea = document.getElementById('content-area');
            
            // æ›´æ–°è¿›åº¦æ¡
            document.getElementById('progress-text').innerText = `${currentIndex + 1} / ${SENTENCES.length}`;
            document.getElementById('progress-bar').style.width = `${((currentIndex + 1) / SENTENCES.length) * 100}%`;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('btn-prev').disabled = currentIndex === 0;
            document.getElementById('btn-next').disabled = currentIndex === SENTENCES.length - 1;

            // æ›´æ–°æ¨¡å¼æŒ‰é’®æ ·å¼
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.className = "mode-btn flex-1 py-2 text-xs font-medium rounded-md transition-all text-indigo-200 hover:text-white";
            });
            document.getElementById(`btn-mode-${mode}`).className = "mode-btn flex-1 py-2 text-xs font-medium rounded-md transition-all bg-white text-indigo-700 shadow-sm";

            // æ¸²æŸ“ä¸»è¦å†…å®¹
            let html = '';

            if (mode === 'quiz') {
                html = `
                    <div class="space-y-4 w-full fade-in">
                        <div class="text-slate-600 font-medium text-lg mb-2 text-center">${data.cn}</div>
                        <div class="bg-blue-50 p-4 rounded-xl border-2 border-blue-100 min-h-[100px] flex flex-col items-center justify-center">
                            <textarea id="quiz-input" 
                                class="w-full p-3 rounded-lg border-2 border-blue-200 text-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition-colors"
                                rows="3" placeholder="åœ¨è¿™é‡Œè¾“å…¥è‹±æ–‡..."></textarea>
                            <div id="quiz-feedback" class="mt-2 font-bold text-center h-6"></div>
                        </div>
                        <div class="flex justify-center gap-3 mt-2">
                            <button onclick="checkAnswer()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-full font-bold shadow-md active:scale-95 transition-transform flex items-center gap-2">
                                <i data-lucide="trophy" width="18"></i> æ£€æŸ¥
                            </button>
                             <button onclick="showAnswer()" class="text-slate-400 text-sm underline">å·çœ‹ç­”æ¡ˆ</button>
                        </div>
                    </div>
                `;
            } else {
                // Learn or Recite mode
                const isReciteBlur = mode === 'recite' && !showEnglishInRecite;
                
                html = `
                    <div class="flex flex-col items-center w-full fade-in cursor-pointer" onclick="toggleReciteReveal()">
                        <div class="text-center transition-all duration-300 mb-6 w-full ${isReciteBlur ? 'blur-text' : 'no-blur'}">
                            <p class="text-2xl sm:text-3xl font-bold text-slate-800 leading-tight select-none">
                                ${data.en}
                            </p>
                            ${mode === 'recite' && isReciteBlur ? '<p class="text-xs text-indigo-400 mt-2 font-normal text-center w-full no-blur opacity-100">(ç‚¹å‡»æ˜¾ç¤ºè‹±æ–‡)</p>' : ''}
                        </div>
                        
                        <div class="text-center w-full p-4 rounded-xl bg-slate-50 text-slate-600">
                            <p class="text-lg font-medium">${data.cn}</p>
                        </div>
                    </div>
                `;
            }

            contentArea.innerHTML = html;
            lucide.createIcons(); // é‡æ–°æ¸²æŸ“å›¾æ ‡
        }

        function setMode(newMode) {
            mode = newMode;
            showEnglishInRecite = false; // é‡ç½®é®ç›–çŠ¶æ€
            stopAudio();
            render();
        }

        function nextSentence() {
            if (currentIndex < SENTENCES.length - 1) {
                currentIndex++;
                showEnglishInRecite = false;
                stopAudio();
                render();
            }
        }

        function prevSentence() {
            if (currentIndex > 0) {
                currentIndex--;
                showEnglishInRecite = false;
                stopAudio();
                render();
            }
        }

        function toggleReciteReveal() {
            if (mode === 'recite') {
                showEnglishInRecite = !showEnglishInRecite;
                render();
            }
        }

        // --- æ’­æ”¾é€»è¾‘ ---
        function playAudio(rate) {
            stopAudio(); // å…ˆåœæ­¢ä¹‹å‰çš„
            
            const text = SENTENCES[currentIndex].en;
            const u = new SpeechSynthesisUtterance(text);
            
            // å°è¯•è·å–è‹±æ–‡è¯­éŸ³
            const voices = synth.getVoices();
            // ä¼˜å…ˆé€‰ Google US English æˆ– Microsoft David/Zira æˆ– ç³»ç»Ÿé»˜è®¤è‹±æ–‡
            const enVoice = voices.find(v => v.name.includes("Google US English")) || 
                            voices.find(v => v.lang.startsWith("en-US")) || 
                            voices.find(v => v.lang.startsWith("en"));
            
            if (enVoice) u.voice = enVoice;
            
            u.rate = rate; // è¯­é€Ÿ
            u.pitch = 1;
            u.volume = 1;

            synth.speak(u);
        }

        function stopAudio() {
            if (synth.speaking) {
                synth.cancel();
            }
        }

        // --- æµ‹éªŒé€»è¾‘ ---
        function checkAnswer() {
            const input = document.getElementById('quiz-input').value;
            const target = SENTENCES[currentIndex].en;
            const feedbackEl = document.getElementById('quiz-feedback');
            const inputEl = document.getElementById('quiz-input');

            // ç®€å•çš„æ­£åˆ™å¤„ç†ï¼šå»æ ‡ç‚¹ï¼Œè½¬å°å†™
            const cleanInput = input.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g, "").trim();
            const cleanTarget = target.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g, "").trim();

            if (cleanInput === cleanTarget) {
                feedbackEl.innerText = "ğŸ‰ å¤ªæ£’äº†ï¼å®Œå…¨æ­£ç¡®ï¼";
                feedbackEl.className = "mt-2 font-bold text-center h-6 text-green-600 animate-bounce";
                inputEl.classList.remove('border-blue-200', 'border-red-300');
                inputEl.classList.add('border-green-500', 'bg-green-50');
                playAudio(1.0); // ç­”å¯¹è‡ªåŠ¨æ’­æ”¾
            } else {
                feedbackEl.innerText = "è¿˜ä¸å¯¹å“¦ï¼Œå†è¯•ä¸€æ¬¡ï¼";
                feedbackEl.className = "mt-2 font-bold text-center h-6 text-red-500";
                inputEl.classList.remove('border-blue-200', 'border-green-500');
                inputEl.classList.add('border-red-300', 'bg-red-50');
            }
        }

        function showAnswer() {
             const inputEl = document.getElementById('quiz-input');
             inputEl.value = SENTENCES[currentIndex].en;
             checkAnswer();
        }

        // è§£å†³ Safari è¯­éŸ³åŠ è½½å¯èƒ½å»¶è¿Ÿçš„é—®é¢˜
        window.speechSynthesis.onvoiceschanged = function() {
            // å¯ä»¥åœ¨è¿™é‡Œæ›´æ–°è¯­éŸ³åˆ—è¡¨
        };

    </script>
</body>
</html>